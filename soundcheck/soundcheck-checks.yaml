---
- id: has_less_than_ten_open_issues
  rule:
    factRef: github:default/repo_details
    path: $.open_issues
    operator: lessThan
    value: 10
  passedMessage: |
    Less than 10 open issues
  failedMessage: |
    Ten or more open issue(s)
- id: is_repo_public
  rule:
    factRef: github:default/repo_details
    path: $.private
    operator: equal
    value: false
  passedMessage: |
    Repo is private
  failedMessage: |
    Repo is not private, change repo to private
- id: default_branch_is_main
  rule:
    factRef: github:default/repo_details
    path: $.default_branch
    operator: equal
    value: main
  passedMessage: |
    Default branch is main
  failedMessage: |
    Change default branch to main
- id: has_readme_check # The name of the check
  rule: # How to evaluate this check
    factRef: scm:default/readme_and_foundation_files_exist_fact # The fact data to reference
    path: $.readme_exists # The path to the field to analyze
    operator: equal # Indicates the operation to apply
    value: true # The desired value of the field indicated in the path, above.
- id: has_foundation_file_check
  rule:
    factRef: scm:default/readme_and_foundation_files_exist_fact
    path: $.foundation_exists
    operator: equal
    value: true
- id: java_service_runs_test_on_prs
  rule:
    factRef: scm:default/java_service_runs_tests_on_prs_fact
    path: $.matches
    operator: equal
    value: true
# Terra Prod Readiness Checks

- id: has_team_ownership_defined
  rule:
    factRef: catalog:default/entity_descriptor
    path: $.spec.owner
    operator: matches
    value: '^[a-zA-Z0-9-_]+$'
  schedule:
    frequency:
      cron: '* * * * *'
    filter:
      kind: 'Component'
- id: has_service_documentation
  rule:
    factRef: scm:default/architecture_diagrams_exist_fact
    path: $.architecture.md_exists
    operator: equal
    value: true
- id: follows_semantic_versioning
  rule:
    factRef: scm:default/follows_semantic_versioning_fact
    path: $.matches
    operator: equal
    value: true
- id: is_containerized
  rule:
    any:
      - factRef: scm:default/dockerfile_exists_fact
        path: $.dockerfile_exists
        operator: equal
        value: true
      - factRef: scm:default/uses_jib_for_image_build_fact
        path: $.matches
        operator: equal
        value: true
- id: prs_require_two_reviews
  rule:
    factRef: github:main/branch_protections
    path: $.required_pull_request_reviews.required_approving_review_count
    operator: greaterThanInclusive
    value: 2
- id: has_unit_tests
  rule:
    all:
      - factRef: scm:default/java_service_runs_tests_on_prs_fact
        path: $.matches
        operator: equal
        value: true
- id: has_contract_tests
  rule:
    all:
      - factRef: scm:default/can_run_pact_tests_fact
        path: $.matches
        operator: equal
        value: true
- id: has_static_code_analysis
  rule:
    all:
      - factRef: scm:default/can_run_sonar_scans_on_prs_fact
        path: $.matches
        operator: equal
        value: true

